
&НаКлиенте
Процедура ПриОткрытии(Отказ)
    ТолькоПросмотр = Истина
КонецПроцедуры

&НаКлиенте
Процедура Выгрузить(Команда)
    ЭСЧФклиент.ВыгрузитьДокументы(Объект.Ссылка)
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьВХранилище(Команда)
    ЭСЧФклиент.ВыгрузитьДокументы(Объект.Ссылка, Истина)
КонецПроцедуры

&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)

	Если Объект.РасположениеФайла = 0 Тогда
		РасположениеФайла = "Не указано"
	ИначеЕсли Объект.РасположениеФайла = 1 Тогда
		РасположениеФайла = "В базе"
	ИначеЕсли Объект.РасположениеФайла = 2 Тогда
		РасположениеФайла = "В хранилище на диске"
	ИначеЕсли Объект.РасположениеФайла = 3 Тогда
		РасположениеФайла = "Перенесён в архив"
	Иначе
		РасположениеФайла = "Ошибка определения значения"
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура Просмотр(Команда)

	Если Объект.Ссылка.Пустая() Тогда
		Возврат;
	КонецЕсли;
	
	Структура = Новый Структура;
	Товары = ЭСЧФобщий.ПолучитьТаблицуТоваровЭСЧФ();
	Грузоотправители = ЭСЧФобщий.ПолучитьТаблицуГрузоотправителиГрузополучателиЭСЧФ();
	Грузополучатети = ЭСЧФобщий.ПолучитьТаблицуГрузоотправителиГрузополучателиЭСЧФ(Ложь);
	ДокументыПоставки = ЭСЧФобщий.ПолучитьТаблицуДокументовПоставкиЭСЧФ();
	Отказ = Ложь;
	Ошибки = Новый Массив;
	
	ЭСЧФобщий.ВыделитьДокументДляЧтенияИзПодписанного( Объект.Ссылка, Структура, Товары, Грузоотправители, Грузополучатети, ДокументыПоставки, Отказ, Ошибки);
	
	Для каждого Ошибка Из Ошибки Цикл
		Сообщение = Новый СообщениеПользователю;
		Если ТипЗнч(Ошибка) = Тип("Строка") Тогда
			Сообщение.Текст = Ошибка;
		Иначе
			Сообщение.Текст = Ошибка.Текст;
		КонецЕсли;
		Сообщение.Сообщить();
	КонецЦикла;
	
	Если Структура.ТипСодержимого = "issuance" И Не Отказ Тогда
		ЭСЧФклиент.ПоказатьЭСЧФ( Объект.Код, Неопределено, Структура.ОтправительУНП, Структура, Грузоотправители, Грузополучатети, ДокументыПоставки, Товары, Неопределено, Объект.Ссылка, Неопределено, Неопределено, Неопределено, Ошибки, ЭтаФорма);
	ИначеЕсли Структура.ТипСодержимого = "stasut_info" Тогда
		Макет = ПолучитьОбщийМакет("КвитанцияЭСЧФ");
		Квитанция = Макет.ПолучитьОбласть("Квитанция");
		Квитанция.Параметры.Заполнить(Структура);
		ТабДок = Новый ТабличныйДокумент;
		ТабДок.Вывести(Квитанция);
		ТабДок.Показать("Квитанция документа """ + Объект.Ссылка + """");
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ПросмотрXML(Команда)

	Если Объект.Ссылка.Пустая() Тогда
		Возврат;
	КонецЕсли;
	
	Структура = "";
	Отказ = Ложь;
	Ошибки = Новый Массив;
	
	ЭСЧФобщий.ВыделитьДокументДляЧтенияИзПодписанного( Объект.Ссылка, Структура,,,,, Отказ, Ошибки);
	
	Для каждого Ошибка Из Ошибки Цикл
		Сообщение = Новый СообщениеПользователю;
		Если ТипЗнч(Ошибка) = Тип("Строка") Тогда
			Сообщение.Текст = Ошибка;
		Иначе
			Сообщение.Текст = Ошибка.Текст;
		КонецЕсли;
		Сообщение.Сообщить();
	КонецЦикла;
	
	ТекстовыйДокумент = Новый ТекстовыйДокумент;
	ТекстовыйДокумент.УстановитьТекст(Структура);
	ТекстовыйДокумент.ТолькоПросмотр = Истина;
	ТекстовыйДокумент.Показать("Данные документа """ + Объект.Ссылка + """");

КонецПроцедуры
